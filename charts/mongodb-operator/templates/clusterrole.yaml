{{- if .Values.rbac.create -}}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "mongodb-operator.fullname" . }}
  labels:
    {{- include "mongodb-operator.labels" . | nindent 4 }}
rules:
  # MongoDB CRDs
  - apiGroups:
      - mongodb.keiailab.com
    resources:
      - mongodbs
      - mongodbshardeds
      - mongodbbackups
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - mongodb.keiailab.com
    resources:
      - mongodbs/status
      - mongodbshardeds/status
      - mongodbbackups/status
    verbs:
      - get
      - patch
      - update
  - apiGroups:
      - mongodb.keiailab.com
    resources:
      - mongodbs/finalizers
      - mongodbshardeds/finalizers
      - mongodbbackups/finalizers
    verbs:
      - update

  # Core resources
  - apiGroups:
      - ""
    resources:
      - pods
      - pods/exec
      - services
      - endpoints
      - persistentvolumeclaims
      - events
      - configmaps
      - secrets
      - serviceaccounts
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Apps resources
  - apiGroups:
      - apps
    resources:
      - deployments
      - statefulsets
      - replicasets
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Batch resources (for backup jobs)
  - apiGroups:
      - batch
    resources:
      - jobs
      - cronjobs
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Autoscaling (for HPA)
  - apiGroups:
      - autoscaling
    resources:
      - horizontalpodautoscalers
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Policy (for PDB)
  - apiGroups:
      - policy
    resources:
      - poddisruptionbudgets
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Networking (for NetworkPolicy)
  - apiGroups:
      - networking.k8s.io
    resources:
      - networkpolicies
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # cert-manager (for TLS)
  - apiGroups:
      - cert-manager.io
    resources:
      - certificates
      - issuers
      - clusterissuers
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Prometheus monitoring
  - apiGroups:
      - monitoring.coreos.com
    resources:
      - servicemonitors
      - prometheusrules
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch

  # Coordination (for leader election)
  - apiGroups:
      - coordination.k8s.io
    resources:
      - leases
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
{{- end }}
